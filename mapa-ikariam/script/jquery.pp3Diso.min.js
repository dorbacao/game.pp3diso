/**
 * pp3Diso
 * http://www.prelude-prod.fr
 *
 * @author Jean-François RENAULD
 * @version 1.5
 * Cette oeuvre est mise à disposition selon les termes de la Licence Creative Commons Paternité - Partage à l'Identique 3.0 non transcrit.
 * http://creativecommons.org/licenses/by-sa/3.0/deed.fr
 *
 * Si vous utilisez ce plugin, vous devez mettre un lien retour vers le site : http://www.prelude-prod.fr
 *
 * Date: Mon Jun 10 16:00:00 UTC 2013
 */
(function(a){a.fn.pp3Diso=function(a6){var a6=a.extend({CSSid:"",mapId:1,map:"",mapZones:"",mapZonesColors:"",zone:"",tx:0,ty:0,ty2:0,zoom:1,positionFixe:false,pathfinding:false,PF_corners:true,cursorPF:"",cursorZindex:0,PF_decx:0,PF_decy:0,PF_max:false,mousewheel:false,zoom_min:0.25,zoom_max:10,zoom_pas:0.5,fluide:true,nbrTitleSetsSlide:1,auto_resize:true,mode2d:false,mode2d_viewx:5,mode2d_viewy:5,mode2d_select:"#FBE6C1",mode2d_select_off:"#F47070",mode2d_fond:"#ffffff",titre_map:{},titre_case:"",mode2d_avatar:"Avatar",move_avatar_speed:50,bulle_auto_x:true,bulle_auto_y:"top",bulle_obj_deca_y:6,keys:true,keys_tab:{key_n:[38,104],key_ne:[105],key_e:[39,102],key_se:[99],key_s:[40,98],key_so:[97],key_o:[37,100],key_no:[103],key_zoom:[33],key_dezoom:[34],key_clic:[32,101]},prefix:"map-",path:"images/",fogofwar:0,speed_avatar:250,speed_map:100,speed_map_while:100,speed_by_titleset:1,drag:true,cursorDelay:false,oncursordelay:function(bt,bv,bu){},onmoveavatar:function(bt,bv,bu){},beforemoveavatar:function(bt,bu){return true},beforeclosewin:function(bu,bt){return true},afterclosewin:function(bu,bt){},onenterbuilding:function(bt,bv,bu){},onleavebuilding:function(bt,bv,bu){},onenterobject:function(bt,bv,bu){},onleaveobject:function(bt,bv,bu){},onclicbuilding:function(bt,bv,bu){},onclicobject:function(bt,bv,bu){},onchangezoom:function(bt){}},a6);var j=a(this);var d=this;var ak=("ontouchstart" in window);if(a6.positionFixe==true){a6.drag=false}a6.ty2=(a6.tx>>2);var n=1;var ba="";if(a.browser.msie&&((a.browser.version)|0)<9){ba="msie"}var e=0;var c=0;var am=0;var W=0;if(a6.mode2d){mousewheel=false}var v;var R=a6.tx;var Q=a6.ty;var av=a6.ty2;var aj="";var aF=0;var aC=0;var bq=1;var bo=1;var q,bg,aE;var a2,a1;var ag=0;var af=0;var aw=null;var A=[];var aU=[];var Z=false;var O,N;var m="";var aB="";var bc=0;var bb=0;var U=0;var S=0;var ao=false;var ah;var bm=false;var aq=false;var w;var a5=[];var bl=a6.PF_max;var aa;var aT;var bi=false;var M,bn,J,K,ac,I,E;var G,D,aK,al,aM,aL,C;var bj=[];var ap,bp,ar;var ae,ad,H;var az,ax;var an=false;var r,p;var a0=false;var a3=0;move_map_waiting=false;aN();var z;var bs=null;var L="";var au=1;function aN(){v=~~(a6.zoom*100)+"%";a6.tx=R*a6.zoom;a6.ty=Q*a6.zoom;a6.ty2=av*a6.zoom;bi=false;ae=j.width();ad=j.height();if(a6.zone=="undefined"){a6.zone=""}var bA=j.children(".pp3diso_users").detach();j.children().remove().empty();j.append(bA);a(".pp3diso_users").css({"z-index":760000});if(!a6.mode2d){j.append('<div id="pp3Diso-wait"></div>');aa=a("#pp3Diso-wait")}bn=a6.map.split(":");if(a6.zone!=""){var bz=a6.zone.split(":")}M=a6.path+a6.prefix;dummy=bn[0].split(",");J=bn.length;K=dummy.length;w=new Array(K);for(bt=0;bt<J;bt++){w[bt]=new Array(J)}aK=(a6.tx>>1);al=a6.ty2;aM=K*(a6.tx);aL=J*(al<<1)+(a6.ty2);C=aM>>1;if(a6.mapZones!=""){var bv=a6.mapZones.split(":")}ac=new Array(J);I=new Array(J);E=new Array(J);z=new Array(J);ap=new Array(J);G=0;D=0;ai();for(var by=1;by<=J;by++){E[by]=new Array(K);ac[by]=new Array(K);ap[by]=new Array(K);I[by]=new Array(K);z[by]=new Array(K);var bx=bn[by-1].split(",");if(a6.zone!=""){var bw=bz[by-1].split(",")}if(a6.mapZones!=""){var bu=bv[by-1].split(",")}for(var bt=1;bt<=K;bt++){E[by][bt]=~~(bx[bt-1]);if(a6.fogofwar>0){I[by][bt]=0}else{I[by][bt]=1}f(bt,by);if(a6.zone!=""){ac[by][bt]=~~(bw[bt-1])}else{if(E[by][bt]>0){ac[by][bt]=1}else{ac[by][bt]=0}}if(a6.mapZones!=""){ap[by][bt]=(bu[bt-1]|0)}else{ap[by][bt]=0}}}if(a6.auto_size){j.css({width:aM,height:aL})}e=((ae-aM)>>1);c=((ad-aL)>>1);am=e;W=c;aR(E);bd((K|0),(J|0));aW(E);a("#ppISO").bind("mouseenter",function(){a("#ppISO").focus()});a("#ppISO").focus()}function aR(bO){O=0;N=0;var bG="";var bJ=[0,al,aK,0,a6.tx,al,aK,al<<1];var bK=(a6.zoom<<3);var bI=(bK>>1);var by=[-bK,al,aK,-bI,a6.tx+bK,al,aK,(al<<1)+bI];if(a("#pp3Diso-conteneur").length==0){j.append('<div id="pp3Diso-conteneur"></div>')}a(".pp3diso").unbind("keyup");H=a("#pp3Diso-conteneur");if(!a6.mode2d){H.css({display:"block",position:"absolute",top:9999,left:9999,width:aM,height:aL})}if(a6.mousewheel){ab()}var bE=a6.mapZonesColors.split(":");if(!a6.mode2d&&a6.mapZones!=""&&a("#pp3Diso-mapZone").length==0){H.append('<div id="pp3Diso-mapZone"></div>');var bw=bE.length;bp=new Array(bw);ar=new Array(bw);var bP=new Array(bw);for(var bL=0;bL<bw;bL++){bP[bL]=document.createElement("canvas");bP[bL].id="pp3Diso-mapZone-canvas-"+bL;a("#pp3Diso-mapZone").append(bP[bL]);if(a.browser.msie&&!window.HTMLCanvasElement){bp[bL]=window.G_vmlCanvasManager.initElement(bP[bL])}else{bp[bL]=a("#pp3Diso-mapZone-canvas-"+bL)[0]}ar[bL]=bp[bL].getContext("2d");bp[bL].width=aM;bp[bL].height=aL;a("#pp3Diso-mapZone-canvas-"+bL).css({display:"none",position:"absolute",top:0,left:0,"z-index":299000,"-moz-opacity":0.5,opacity:0.5,filter:"alpha(opacity=50)"})}a("#pp3Diso-mapZone").css({display:"block",position:"absolute",top:0,left:0,width:aM,height:aL,"z-index":299000})}if(!a6.mode2d){aa.css("display","block")}if(a("#pp3Diso-bulle").length==0){H.append('<div id="pp3Diso-bulle"></div>')}aT=a("#pp3Diso-bulle");aT.css("display","none");var bN="pp3diso-Map-"+n;n++;var bz='<map name="'+bN+'" id="'+bN+'">';for(var bD=1;bD<=J;bD++){for(var bF=1;bF<=K;bF++){bG="c_"+bD+"_"+bF;var bB=bk(bD,bF);var bC=u(bD,bF);z[bD][bF]=new Array(2);z[bD][bF][0]=(bC|0);z[bD][bF][1]=(bB|0);if(a6.mapZones!=""&&!a6.mode2d){if(ap[bD][bF]>0){var bH=ap[bD][bF]-1;ar[bH].fillStyle=bE[bH];ar[bH].beginPath();ar[bH].moveTo(~~(by[0]+bC),~~(by[1]+bB));var bx=bJ.length-1;for(var bM=2;bM<bx;bM+=2){ar[bH].lineTo(~~(by[bM]+bC),~~(by[bM+1]+bB))}ar[bH].closePath();ar[bH].fill()}}if(a6.mode2d){}else{var bA="";var bx=bJ.length;for(var bL=0;bL<bx;bL+=2){var bv=~~((bJ[bL])+bC);var bu=~~((bJ[bL+1])+bB);bA+=","+bv+","+bu}bA=bA.substring(1);var bt="s_"+bD+"_"+bF;bA='<area id="'+bt+'" class="pp3diso-shap" shape="poly" coords="'+bA+'" alt="" />';bz+=bA}}}if(!a6.mode2d){bz+="</map>";H.prepend('<div id="pp3diso-clicks"><img src="images/vide.gif" id="pp3diso-mapControl" width="'+aM+'" height="'+aL+'" alt="" />'+bz+"</div>");a("#pp3diso-mapControl").attr("usemap","#"+bN);a("#pp3diso-clicks").css({"z-index":750000,position:"absolute",left:0,top:0,display:"block"})}if(a6.keys){a(window).keyup(function(bW){var bR=U;var bX=S;var bU=false;var bQ=null;for(var bV in a6.keys_tab){for(var bT in a6.keys_tab[bV]){if(a6.keys_tab[bV][bT]==bW.keyCode){bQ=bV;bU=true;break}}}switch(bQ){case"key_n":bX--;break;case"key_ne":bX--;bR++;break;case"key_e":bR++;break;case"key_se":bX++;bR++;break;case"key_s":bX++;break;case"key_so":bX++;bR--;break;case"key_o":bR--;break;case"key_no":bX--;bR--;break;case"key_clic":if(aZ(bR,bX)){B(bR,bX,true)}break;case"key_zoom":b(a6.zoom+a6.zoom_pas);break;case"key_dezoom":b(a6.zoom-a6.zoom_pas);break}if(bU){if(!a6.mode2d){var bS=a("#s_"+bX+"_"+bR);if(bS.length){a8(bS)}}else{var bS=a("#c_"+bX+"_"+bR);if(bS.length){a8(bS)}}}if(bU===true){bW.stopPropagation();bW.preventDefault();return}else{return false}})}if(!a6.mode2d){a(".pp3diso-shap").bind("click",(function(){if(window.Touch){a8(a(this))}if(!a0){aP(a(this))}}));if(a6.cursorDelay!==false){a(".pp3diso-shap").bind("mouseenter",function(){L=a(this).attr("id");if(au==1){bs=window.setTimeout(function(){window.clearTimeout(bs);var bQ=L.split("_");a6.oncursordelay(bQ[2],bQ[1],a6.mapId)},a6.cursorDelay)}});a(".pp3diso-shap").bind("mouseout",function(){window.clearTimeout(bs)})}if(!ak){a(".pp3diso-shap").bind("mouseenter",function(){a8(a(this))})}}if(a6.drag&&!a6.mode2d){a("#pp3Diso-conteneur").bind("touchstart",function(bR){a0=false;var bS=bR.originalEvent;var bQ=H.position();r=bS.changedTouches[0].clientX-bQ.left;p=bS.changedTouches[0].clientY-bQ.top;a("#pp3Diso-conteneur").bind("click",function(){return false});a("#pp3Diso-conteneur").bind("touchmove",function(bT){a9(bT)});a("#pp3Diso-conteneur").bind("touchend touchcancel",function(bT){br(bT,a(this))});if(!aq){aq=true;setTimeout(function(){aq=false},100)}});a(".pp3diso-shap").bind("mousedown",function(bS){a0=false;var bQ=bS||window.event;var bR=H.position();r=bQ.clientX-bR.left;p=bQ.clientY-bR.top;a("#pp3Diso-conteneur").bind("click",function(){return false});a("#pp3Diso-conteneur").bind("mousemove",aD).bind("mouseup",br);return false})}j.focus()}function aD(bw){bw.preventDefault();a0=true;var bv=bw||window.event;var bu=bv.clientX-r;var bt=bv.clientY-p;if(bt>(a6.ty<<1)){bt=a6.ty<<1}if(bu>(a6.tx)){bu=a6.tx}if(bu<-((aM-ae)+a6.tx)){bu=-((aM-ae)+a6.tx)}if(bt<-((aL-ad)+a6.ty)){bt=-((aL-ad)+a6.ty)}H.css({left:bu,top:bt});return false}function br(bz,bx){var by=H.position();var bu=~~(-by.left/a6.tx);var bt=~~(-by.top/a6.ty);var bw=e;var bv=c;e=by.left;c=by.top;a("#pp3Diso-conteneur").unbind("mousemove",aD).unbind("mouseup",br);if(bw!=e&&bv!=c){aW(E)}a(".pp3diso-shap").unbind("touchmove");a(".pp3diso-shap").unbind("ontouchend");if(aq){aq=false;aP(bx)}return false}function a9(bv){bv.preventDefault();a0=true;var bw=bv.originalEvent;var bu=bw.changedTouches[0].clientX-r;var bt=bw.changedTouches[0].clientY-p;if(bt>(a6.ty<<1)){bt=a6.ty<<1}if(bu>(a6.tx)){bu=a6.tx}if(bu<-((aM-ae)+a6.tx)){bu=-((aM-ae)+a6.tx)}if(bt<-((aL-ad)+a6.ty)){bt=-((aL-ad)+a6.ty)}H.css({left:bu,top:bt});return false}function ab(){var bu=["DOMMouseScroll","mousewheel"];if(this.addEventListener){for(var bt=bu.length;bt;){j[0].addEventListener(bu[--bt],be,false)}}else{j[0].onmousewheel=be}}var aX=0;function be(by){var bA=new Date();by.preventDefault();by.stopPropagation();var bw=by||window.event,bv=[].slice.call(arguments,1),bz=0,bx=true,bu=0,bt=0;by=a.event.fix(bw);by.type="mousewheel";if(bw.wheelDelta){bz=bw.wheelDelta/120}if(bw.detail){bz=-bw.detail/3}bt=bz;if(bw.axis!==undefined&&bw.axis===bw.HORIZONTAL_AXIS){bt=0;bu=-1*bz}if(bw.wheelDeltaY!==undefined){bt=bw.wheelDeltaY/120}if(bw.wheelDeltaX!==undefined){bu=-1*bw.wheelDeltaX/120}bv.unshift(by,bz,bu,bt);if((bA.valueOf()-aX)>1000){if(bv[1]<0){b(a6.zoom-a6.zoom_pas)}else{b(a6.zoom+a6.zoom_pas)}aX=bA.valueOf()}return false}function t(){if(!a6.mode2d){for(var bw=1;bw<=J;bw++){for(var bt=1;bt<=K;bt++){id="c_"+bw+"_"+bt;var bu=g(bw,bt)+c;var bv=h(bw,bt)+e;if(bv>-tx&&bv<(ae+tx)&&bu>-ty&&bu<(ad+ty)){H.append('<div id="'+id+'" class="pp3diso-sol"></div>');a("#"+id).css({"z-index":aS(bw,bt),position:"absolute",left:(bv|0),top:(bu|0),width:a6.tx,height:a6.ty,display:"block"})}}}}}function P(){if(a6.mode2d){aW(E)}if(a3==0&&!a6.mode2d){if(move_map_waiting){H.css("display","none")}move_map_waiting=false;bm=true;if(a6.positionFixe==true){H.animate({left:(am|0),top:(W|0)},a6.speed_map,function(){aW(E);bm=false;H.fadeIn("100");aa.css("display","none")})}else{if(a6.fluide){H.animate({left:(e|0),top:(c|0)},a6.speed_map,function(){aW(E);bm=false;H.fadeIn("100");aa.css("display","none")})}else{H.css({left:(e|0),top:(c|0)});aW(E);bm=false;aa.css("display","none")}}}else{move_map_waiting=true}}function bf(bt,bu){if(!a6.mode2d){bt=(bt|0);bu=(bu|0);id="c_"+bu+"_"+bt;a("#"+id).fadeTo(0,I[bu][bt]);id="b_"+bu+"_"+bt;a("#"+id).fadeTo(0,1);id="o_"+bu+"_"+bt;a("#"+id).fadeTo(0,1)}}function aA(bB,bA,bv){bB=(bB|0);bA=(bA|0);bv=(bv|0);if(bA<1||bB<1||bA>J||bB>K){return}if(I[bA][bB]<bv){I[bA][bB]=bv}if(I[bA][bB]>1){I[bA][bB]=1}bf(bB,bA);var bu=a6.fogofwar;for(var bt=bB-bu;bt<=bB+bu;bt++){var bx=Math.abs(bt-bB);for(var bz=bA-bu;bz<=bA+bu;bz++){var by=Math.abs(bz-bA);if(bx>by){by=bx}if(bt!=bB||bz!=bA){if(!(bz<1||bt<1||bz>J||bt>K)){var bw=(bv/by);if(I[bz][bt]<bw){I[bz][bt]=bw}if(I[bz][bt]>1){I[bz][bt]=1}bf(bt,bz)}}}}}function aW(bO){var bF="";var bt="";var bM=a6.tx*3;var by=a6.ty*3;if(U<1){U=1}if(S<1){S=1}if(a6.mode2d){var bD=(U|0)-(a6.mode2d_viewx|0);var bA=(U|0)+(a6.mode2d_viewx|0);if(bD<1){bA=bA-(bD-1)}if(bA>K){bD=K-(((a6.mode2d_viewx|0)<<1))}var bB=(S|0)-(a6.mode2d_viewy|0);var bz=(S|0)+(a6.mode2d_viewy|0);if(bB<1){bz=bz-(bB-1)}if(bz>J){bB=J-(((a6.mode2d_viewy|0)<<1))}if(bD<1){bD=1}if(bA>K){bA=K}if(bB<1){bB=1}if(bz>K){bz=J}}var bx=ae+bM;var bv=ad+by;for(var bI=1;bI<=J;bI++){if(a6.mode2d){if(bI>=bB&&bI<=bz){bt=bt+'<tr><th id="y'+bI+'" axis="axe des ordonn�es">'+bI+"</th>"}}var bu="c_"+bI;for(var bJ=1;bJ<=K;bJ++){var bH=z[bI][bJ][0];var bG=z[bI][bJ][1];var bE=bH+e;var bL=bG+c;var bK=bu+"_"+bJ;var bw=a("#"+bK);if(a6.mode2d){if(bJ>=bD&&bJ<=bA&&bI>=bB&&bI<=bz){bt=bt+'<td headers="x'+bJ+" y"+bI+'" id="'+bK+'"></td>'}}else{if(bE>-bM&&bE<(bx)&&bL>-by&&bL<(bv)){if(bw.length==0){bt=bt+'<div id="'+bK+'" class="pp3diso-sol"></div>'}else{if(a6.fogofwar>0){bf(bJ,bI)}if(bw[0].getAttribute("display")!="block"){bw.css("display","block")}}}else{bw.remove().empty()}}}if(a6.mode2d){if(bI>=bB&&bI<=bz){bt=bt+"</tr>"}}}if(a6.mode2d){totalFrag_dummy='<table id="pp3diso_table">';totalFrag_dummy=totalFrag_dummy+"<tr><td>&nbsp;</td>";for(bJ=bD;bJ<=bA;bJ++){totalFrag_dummy=totalFrag_dummy+'<th id="x'+bJ+'" axis="axe des abscisses">'+bJ+"</th>"}totalFrag_dummy=totalFrag_dummy+"</tr>";bt=totalFrag_dummy+bt+"</table>";a("#pp3diso_table").remove()}H.append(bt);var bC="100%";for(var bI=1;bI<=J;bI++){for(var bJ=1;bJ<=K;bJ++){var bH=h(bI,bJ);var bG=g(bI,bJ);var bE=bH+e;var bL=bG+c;var bK="c_"+bI+"_"+bJ;var bw=a("#"+bK);if(a6.mode2d){var bN=aI(bJ,bI,bO);bw.html(bN).click(function(){var bP=a(this).attr("id");var bR=bP.split("_");var bS=bR[2];var bQ=bR[1];if(aZ(bS,bQ)){B(bS,bQ,true)}a8(a(this))}).mouseover(function(){a8(a(this))})}else{if(bE>-bM&&bE<(ae+bM)&&bL>-by&&bL<(ad+by)){if(!bw.length==0){bF=bO[bI][bJ]+".png";if(bF!="NaN.png"){bF=M+bF;if(a6.zoom!=1&&ba=="msie"){bw.css({"z-index":aS(bI,bJ),position:"absolute",left:(bH|0),top:(bG|0),width:a6.tx,height:a6.ty,"background-image":"url('"+bF+"')",display:"block","-webkit-background-size":bC+" "+bC,"-o-background-size":bC+" "+bC,"-moz-background-size":bC+" "+bC,"background-size":bC+" "+bC,"background-position":"center center","background-repeat":"no-repeat","-ms-filter":"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+bF+"', sizingMethod='scale')",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+bF+"', sizingMethod='scale')"})}else{bw.css({"z-index":aS(bI,bJ),position:"absolute",left:(bH|0),top:(bG|0),width:a6.tx,height:a6.ty,"background-image":"url('"+bF+"')",display:"block","-webkit-background-size":bC+" "+bC,"-o-background-size":bC+" "+bC,"-moz-background-size":bC+" "+bC,"background-size":bC+" "+bC})}}}}}}}}function aI(bt,by,bx){var bw="<p>";var bv="";var bu=" ";if(a6.titre_case!=""){bv=a6.titre_case;bv=aJ(bv,"[x]",bt);bv=aJ(bv,"[y]",by)}bw=""+bv+bu;bw=bw+""+a6.titre_map[bx[by][bt]]+bu;bv=aG(bt,by);if(bv!=""){bw=bw+""+bv+bu}if(bq==bt&&bo==by){bw=bw+""+a6.mode2d_avatar+bu}bw=bw+"</p>";return bw}function aJ(bv,bu,bt){SRRi=bv.indexOf(bu);SRRr="";if(SRRi==-1){return bv}SRRr+=bv.substring(0,SRRi)+bt;if(SRRi+bu.length<bv.length){SRRr+=aJ(bv.substring(SRRi+bu.length,bv.length),bu,bt)}return SRRr}function aS(bu,bt){return(bt<<1)+(bu<<1)}function u(bv,bt){bt=bt|0;bv=bv|0;var bu=C+((bt-1)*aK);bu=bu-(aK*(bv+1))+aK;return(bu|0)}function bk(bv,bt){bt=bt|0;bv=bv|0;var bu=(bv-1)*(al);bu=bu+(al*(bt-1));return(bu|0)}function h(bu,bt){return z[bu|0][bt|0][0]}function g(bu,bt){return z[bu|0][bt|0][1]}function V(bt){return(bt|0)}function aH(bt,bv){for(var bu in bj){if(bj[bu]["x"]==bt&&bj[bu]["y"]==bv){return true}}return false}function aG(bt,bx,bv){if(typeof(bv)=="undefined"){bv=" / "}var bw="";for(var bu in bj){if(bj[bu]["x"]==bt&&bj[bu]["y"]==bx){bw=bw+bv+bj[bu]["titre"]}}bw=bw.substr(bv.length);return bw}function a8(bv){var bw=bv.attr("id");if(typeof(bw)=="undefined"){return}var by=bw.split("_");var bu=by[2];var bA=by[1];if(U!=bu||S!=bA){if(ac[S][U]==2){a6.onleavebuilding(U,S,a6.mapId)}else{if(aH(U,S)){a6.onleaveobject(U,S,a6.mapId)}}}U=bu;S=bA;var bt=h(bA,bu)+(bc*a6.zoom);var bz=g(bA,bu)+(bb*a6.zoom);if(aZ(bu,bA)){a("#pp3diso-cursor-img").attr("src",m);color_m2d=a6.mode2d_select}else{a("#pp3diso-cursor-img").attr("src",aB);color_m2d=a6.mode2d_select_off}if(!a6.mode2d){if(a6.cursorZindex>0){var bx=300000+aS(bA|0,bu|0)+(a6.cursorZindex|0);a("#pp3diso-cursor").css({display:"block",left:bt,top:bz,"z-index":bx})}else{a("#pp3diso-cursor").css({display:"block",left:bt,top:bz})}}else{a("#pp3diso_table td").css("background-color",a6.mode2d_fond);bv.css("background-color",color_m2d);bv.first("p").focus()}if(ac[bA][bu]==2){a6.onenterbuilding(bu,bA,a6.mapId)}else{if(aH(bu,bA)){a6.onenterobject(bu,bA,a6.mapId)}}}var aV=false;function ay(){if(!aV){a5=null;a5=[];for(y=0;y<J;y++){for(x=0;x<J;x++){if(ac[y+1][x+1]==1){w[x][y]=1}else{w[x][y]=0}}}}}function a4(bD,bB){var by=bq;var bv=bo;var bz=bD;var bw=bB;var bC,bx,bA,bu;ay();if(bl!=false){bC=by-(bl+1);bx=by+bl;bA=bv-(bl+1);bu=bv+bl;if(bC<0){bC=0}if(bx>=K){bx=K}if(bA<0){bA=0}if(bu>=J){bu=J}}else{bC=false;bx=false;bA=false;bu=false}var bt=astar(by-1,bv-1,bz-1,bw-1,w,a6.PF_corners,bA,bu,bC,bx);if(bt!=null){aQ(bt);return true}else{return false}}function a7(bI,bH,bB){var bK=bq;var bJ=bo;var bG=bI;var bF=bH;var bC,bA,bz,by;var bx,bw,bv,bu;ay();if(bl!=false){bx=bK-(bl+1);bw=bK+bl;bv=bJ-(bl+1);bu=bJ+bl;if(bx<0){bx=0}if(bw>=K){bw=K}if(bv<0){bv=0}if(bu>=J){bu=J}}else{bx=false;bw=false;bv=false;bu=false}var bL=astar(bK-1,bJ-1,bG-1,bF-1,w,a6.PF_corners,bv,bu,bx,bw);if(bL!=null){var bE=bL.length;for(var bO=0;bO<bE;bO++){var bN=h(bL[bO].col+1,bL[bO].row+1);var bM=g(bL[bO].col+1,bL[bO].row+1);var bQ=a6.tx>>1;var bD=a6.ty>>1;if(!a6.beforemoveavatar(bI,bH)){return}if(bO<1){bC=bq;bA=bo}else{bC=bL[bO-1].row+1;bA=bL[bO-1].col+1}bz=bL[bO].row+1;by=bL[bO].col+1;var bt=1;if(bz>bC){bt=3}else{if(bz<bC){bt=2}else{if(by>bA){bt=1}else{if(by<bA){bt=4}else{bt=1}}}}if(bO<1){af=bt}else{A.push(bt)}bq=bI;bo=bH;a5.push(bL[bO].col+1+","+bL[bO].row+1);var bP=a("#pp3diso-avatar");aU.push(300000+aS(bL[bO].col+1,bL[bO].row+1));bP.animate({left:bN+aF,top:bM+aC},{step:function(){aw++;if(aw>a6.move_avatar_speed){Y();aw=0}},duration:a6.speed_avatar,complete:function(){if(A.length){af=A.shift()}var bS=a5.pop();var bR=aU.shift();if(aU.length<=1){}bP.css("z-index",bR)}});if(a6.fogofwar>0){aA(bI,bH,1)}}}if(bB){a6.onmoveavatar(bI,bH,a6.mapId)}}function Y(){if(Z){var bt=~~((a2*(ag))*a6.zoom);var bu=~~((a1*(af-1))*a6.zoom);a("#pp3diso-avatar-img").css({left:-bt,top:-bu});ag++;if(ag>=aE){ag=0}}}function aQ(by){a(".pp3Diso_PF").remove().empty();var bx=by.length;for(var bw=0;bw<bx;bw++){var bt=h(by[bw].col+1,by[bw].row+1);var bA=g(by[bw].col+1,by[bw].row+1);var bz="pp3Diso_PF_"+bt+"-"+bA;var bv='<div id="'+bz+'" class="pp3Diso_PF"></div>';H.append(bv);var bu="100%";if(a6.zoom!=1&&ba=="msie"){a("#"+bz).css({position:"absolute",display:"block",width:a6.tx,height:a6.ty,"background-image":"url('"+a6.cursorPF+"')","-webkit-background-size":bu+" "+bu,"-o-background-size":bu+" "+bu,"-moz-background-size":bu+" "+bu,"background-size":bu+" "+bu,"background-position":"center center","background-repeat":"no-repeat","-ms-filter":"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a6.cursorPF+"', sizingMethod='scale')",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a6.cursorPF+"', sizingMethod='scale')",left:bt+a6.PF_decx,top:bA+a6.PF_decy,"z-index":300000+by[bw].col+1+by[bw].row+1})}else{a("#"+bz).css({position:"absolute",display:"block",width:a6.tx,height:a6.ty,"background-image":"url('"+a6.cursorPF+"')","-webkit-background-size":bu+" "+bu,"-o-background-size":bu+" "+bu,"-moz-background-size":bu+" "+bu,"background-size":bu+" "+bu,left:bt+a6.PF_decx,top:bA+a6.PF_decy,"z-index":300000+by[bw].col+1+by[bw].row+1})}}}function aZ(bt,bv){if(a6.pathfinding){return a4(bt,bv)}else{var bu=false;if(aj==""){bu=true}else{bt=(bt|0);bv=(bv|0);if(bt>=bq-1&&bt<=bq+1&&bv>=bo-1&&bv<=bo+1){bu=true}else{bu=false}}if(ac[bv][bt]==1&&bu){return true}else{return false}}}function B(bB,bA,bD){bB=(bB|0);bA=(bA|0);var bz=h(bA,bB);var by=g(bA,bB);var bw=a6.tx>>1;var bE=a6.ty>>1;if(a6.pathfinding){a7(bB,bA,bD)}else{if(!a6.beforemoveavatar(bB,bA)){return}if(!a6.mode2d){var bx=a("#pp3diso-avatar");bx.animate({left:bz+aF,top:by+aC},a6.speed_avatar);bx.css({"z-index":300000+aS(bA,bB)})}bq=bB;bo=bA;if(a6.fogofwar>0){aA(bB,bA,1)}if(bD){a6.onmoveavatar(bB,bA,a6.mapId)}}modif_move=false;if(ae<aM+(a6.tx>>1)){var bv=a6.nbrTitleSetsSlide*a6.tx;var bt=~~(bz+e+bw);var bu=((ae>>1)+bv);if(bt>bu){while(bt>bu){e-=bv;bt=~~(bz+e+bw)}modif_move=true}bu=((ae>>1)-bv);if(bt<bu){while(bt<bu){e+=bv;bt=~~(bz+e+bw)}modif_move=true}}if(ad<aL+(a6.ty>>1)){var bv=a6.nbrTitleSetsSlide*a6.ty;var bt=~~(by+c+bE);var bu=((ad>>1)+bv);if(bt>bu){while(bt>bu){c-=bv;bt=~~(by+c+bE)}modif_move=true}bu=((ad>>1)-bv);if(bt<bu){while(bt<bu){c+=bv;bt=~~(by+c+bE)}modif_move=true}}U=bq;S=bo;if(!a6.mode2d){var bC=a("#s_"+S+"_"+U);if(bC.length){a8(bC)}}else{var bC=a("#c_"+S+"_"+U);a8(bC);modif_move=true}if(modif_move){P()}}function aP(bu){var bv=bu.attr("id");var bw=bv.split("_");var bt=bw[2];var bx=bw[1];aT.css("display","none");if(ac[bx][bt]==2){a6.onclicbuilding(bt,bx,a6.mapId)}else{if(aH(bt,bx)){a6.onclicobject(bt,bx,a6.mapId)}}if(aZ(bt,bx)){B(bt,bx,true)}}function F(bt){bt=bt.substring(0,bt.length-2);return(bt|0)}function ai(){a("#pp3diso-avatar").remove().empty()}this.reload=function(bv,bt,bw,bu){bj=null;bj=[];aO();bq=1;bo=1;U=1;S=1;a6.map=bv;a6.zone=bt;a6.mapZones=bw;a6.mapId=bu;aN();P()};this.show=function(bt){if(!a6.fogofwar>0){}B(bq,bo,bt);H.css("display","none")};this.changeCursor=function(bu,bv,bt,bw){a("#pp3diso-cursor").remove().empty();O=0;l(bu,bv,bt,bw)};this.cursor=function(bu,bv,bt,bw){l(bu,bv,bt,bw)};function l(bu,bv,bt,bw){m=bu;aB=bv;bc=bt;bb=bw;if(!a6.mode2d){H.append('<div id="pp3diso-cursor"><img id="pp3diso-cursor-img" src="'+bu+'" alt="" /></div>');a("#pp3diso-cursor-img").load(function(){if(this.width<1){}else{if(O<1){a("#pp3diso-cursor-img").attr("rel",this.width+":"+this.height);O=~~(this.width*a6.zoom);N=~~(this.height*a6.zoom);this.width=O;this.height=N}}});a("#pp3diso-cursor").css({"z-index":299000,position:"absolute",left:0,top:0,display:"block"})}}function bd(bt,bw){var bv=h(bw,bt);var bu=g(bw,bt);e=-((bv-(ae>>1))|0);c=-((bu-(ad>>1))|0);U=bt;S=bw;bq=bt;bo=bw;if(bm){setTimeout(function(){bd(bt,bw)},250)}else{P();H.css("display","block")}}this.moveTo=function(bt,bu){bd(bt,bu)};this.getMonde=function(){var bt=new Array(K+1);for(x=1;x<=K;x++){bt[x]=new Array(J+1);for(y=1;y<=J;y++){bt[x][y]=E[y][x]}}return bt};this.getObjects=function(){return bj};this.getBuilding=function(){var bt=new Array(K+1);for(x=1;x<=K;x++){bt[x]=new Array(J+1);for(y=1;y<=J;y++){bu="";var bv="b_"+y+"_"+x;if(a("#"+bv+" img").length>0){var bu=a("#"+bv+" img").attr("src")}bt[x][y]=bu}}return bt};this.moveObject=function(bt,bB,bz,bu,bx){for(var bw in bj){if(bj[bw]["id"]==bt){bj[bw]["x"]=bB;bj[bw]["y"]=bz;var bC=h(bz,bB)+(bj[bw]["decx"]*a6.zoom);var bA=g(bz,bB)+(bj[bw]["decy"]*a6.zoom);var bv="o_"+bt;if(bu){var by=300000+aS(bz,bB);a("#"+bv).css("z-index",by).animate({left:(bC|0),top:(bA|0)},bx)}else{a("#"+bv).css({"z-index":300000+aS(bz,bB),left:(bC|0),top:(bA|0)})}break}}};this.killAvatar=function(){ai()};this.avatar=function(bu,bz,bw,bt,by,bv,bx){at(bu,bz,bw,bt,by,bv,bx)};function at(bB,bA,bt,bv,bu,bw,bz){if(bm){setTimeout(function(){at(bB,bA,bt,bv,bu,bw,bz)},250);return}ai();if(typeof(bw)=="undefined"){bw=false;bz=1;var bx=1}else{var bx=4}var by=~~(100*bz)+"%";aF=bv*a6.zoom;aC=bu*a6.zoom;q=bv;bg=bu;bq=bB;bo=bA;aE=bz;Z=bw;aj=bt;if(!a6.mode2d){H.append('<div id="pp3diso-avatar"><img id="pp3diso-avatar-img" src="'+bt+'" alt="" /></div>');a("#pp3diso-avatar-img").load(function(){var bD=this.width;var bC=this.height;a2=~~(bD/bz);a1=~~(bC/bx);var bF=~~(a2*a6.zoom);var bE=~~(a1*a6.zoom);var bG=a("#pp3diso-avatar-img");a("#pp3diso-avatar").css({"z-index":300000+aS(bA,bB),position:"absolute",left:h(bA,bB)+bv,top:g(bA,bB)+bu,width:bF,height:bE,overflow:"hidden",display:"block"});bG.css({position:"absolute",display:"block",left:0,top:0,width:bF*bz,height:bE*bx});B(bq,bo,false)})}else{B(bq,bo,false)}}this.moveAvatarTo=function(bt,bu){bq=bt;bo=bu;B(bt,bu,false)};this.changeOneMap=function(bt,bz,bw){var by="c_"+bz+"_"+bt;var bv=a("#"+by);var bu="100%";var bx=M+bw+".png";E[bz][bt]=bw;if(a6.zoom!=1&&ba=="msie"){bv.css({"background-image":"url('"+bx+"')","-webkit-background-size":bu+" "+bu,"-o-background-size":bu+" "+bu,"-moz-background-size":bu+" "+bu,"background-size":bu+" "+bu,"background-position":"center center","background-repeat":"no-repeat","-ms-filter":"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+bx+"', sizingMethod='scale')",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+bx+"', sizingMethod='scale')"})}else{bv.css({"background-image":"url('"+bx+"')","-webkit-background-size":bu+" "+bu,"-o-background-size":bu+" "+bu,"-moz-background-size":bu+" "+bu,"background-size":bu+" "+bu})}};this.changeState=function(bt,bv,bu){ac[bv][bt]=bu};this.getState=function(bt,bu){return ac[bu][bt]};this.getOneMap=function(bt,bu){return E[bu][bt]};this.killBuilding=function(bt,bu){f(bt,bu)};function f(bt,bv){var bu="#b_"+bv+"_"+bt;ac[bv][bt]=1;if(a(bu).length){a(bu).remove().empty()}}this.addBuilding=function(bu,bx,bv,bt,bw){aY(bu,bx,bv,bt,bw)};function aY(bA,by,bC,bv,bu){var bx=v;var bB=h(by,bA)+(bv*a6.zoom);var bz=g(by,bA)+(bu*a6.zoom);ac[by][bA]=2;var bt="b_"+by+"_"+bA;H.append('<div id="'+bt+'" class="pp3diso-batiment"><img src="'+bC+'" alt="" /></div>');var bw=a("#"+bt);bw.attr("rel",bC+":"+bv+":"+bu);a3++;a("#"+bt+" img").load(function(){var bE=~~(this.width*a6.zoom);var bD=~~(this.height*a6.zoom);a(this).attr("rel",this.width+":"+this.height+":"+this.top+":"+this.left);a(this).width(bE).height(bD);a3--;if(move_map_waiting){P()}});bw.css({"z-index":300000+aS(by,bA),position:"absolute",left:(bB|0),top:(bz|0),display:"block"})}function s(){var bu=[];for(var bt in bj){if(bj[bt]["id"]!=""){bu[bt]=[];bu[bt]=bj[bt]}}bj=null;bj=bu}this.killObject=function(bt){T(bt)};function T(bv){var bu="#o_"+bv;for(var bt in bj){if(bj[bt]["id"]==bv){bj[bt]["id"]="";break}}s();if(a(bu).length){a(bu).remove().empty()}}this.addObject=function(bu,bA,bv,bt,bz,by,bw,bx){return X(bu,bA,bv,bt,bz,by,bw,bx)};function X(bD,bB,bF,bw,bu,bA,by,bt){var bE=h(bB,bD)+(bw*a6.zoom);var bC=g(bB,bD)+(bu*a6.zoom);if(typeof(by)=="undefined"){by=""}dummy=bj.length+1;if(typeof(bt)=="undefined"){bt=dummy}var bx=[];bx.id=bt;bx.x=bD;bx.y=bB;bx.sprite=bF;bx.decx=bw;bx.decy=bu;bx.titre=bA;bx.bulle=by;bj.push(bx);if(a6.mode2d){var bt="c_"+bB+"_"+bD;var bG=a("#"+bt);if(bA!=""){bG.append("<p>"+bA+" ("+by+")</p>")}}else{var bv="o_"+bt;a("#"+bv).remove().empty();var bz="";if(by!=""){bz='<div class="pp3diso-obj-bulle">'+by+"<div>"}H.append('<div id="'+bv+'" class="pp3diso-objet"><img src="'+bF+'" alt="" />'+bz+"</div>");a("#"+bv).attr("rel",bF+":"+bw+":"+bu);a3++;a("#"+bv+" img").load(function(){var bN=~~(this.width*a6.zoom);var bM=~~(this.height*a6.zoom);a(this).width(bN).height(bM);if(by!=""){var bH=a("#"+bv+" .pp3diso-obj-bulle");if(a6.bulle_auto_x){var bI=bH.outerWidth();var bL=~~(((bN-bI)>>1));bH.css({left:bL})}if(a6.bulle_auto_y=="top"){var bJ=bH.height();var bK=-(bJ+a6.bulle_obj_deca_y);bH.css({top:bK})}else{if(a6.bulle_auto_y=="bottom"){var bJ=bH.height();var bK=-(bJ+a6.bulle_obj_deca_y);bH.css({bottom:bK})}}}a3--;if(move_map_waiting){P()}});a("#"+bv).css({"z-index":300000+aS(bB,bD),position:"absolute",left:~~(bE),top:~~(bC),display:"block"})}}function bh(){a("#pp3diso-win-fond").fadeTo(500,0,function(){a("#pp3diso-win-fond").remove().empty()});a("#pp3diso-win").remove().empty();a("#pp3diso-clicks").css("display","block")}this.message=function(bv,bE,bB){if(a("#pp3diso-win").length!=0){return}aT.css("display","none");var bA='<div id="pp3diso-win-fond"></div>';bA+='<div id="pp3diso-win"><div id="pp3diso-close"></div><div class="pp3diso-win-texte">'+bE+"</div>";if(bB!=""){var bD=bB.split("||");bA+='<div id="pp3diso-win-form">';var bx=bD.length;for(var bz=0;bz<bx;bz++){by=bD[bz].split("::");bA+='<a href="#" rel="'+by[1]+'" class="pp3diso-win-button" id="pp3diso-win-'+bz+'">'+by[0]+"</a>"}bA+="</div>"}bA+="</div>";j.append(bA);a("#pp3diso-win-0").focus();var bC=a("#pp3diso-win");by=(ae/3);var bu=(by<<1);var bw=(by>>1);var bt=-1;a("#pp3diso-win-fond").css({position:"absolute",width:aM,height:aL,left:0,top:0,"z-index":800000,display:"block"}).fadeTo(0,0.4);bC.css({position:"absolute",width:bu,left:bw,top:50,"z-index":800001,display:"none"});bC.slideDown(100);a("#pp3diso-clicks").css("display","none");a("#pp3diso-close").click(function(bF){bF.preventDefault();bF.stopImmediatePropagation();a6.beforeclosewin(0);bC.slideUp("fast",function(){bh();a6.afterclosewin(bv,bt)})});if(bB!=""){var bD=bB.split("||");var bx=bD.length;for(var bz=0;bz<bx;bz++){var by=bD[bz].split("::");a("#pp3diso-win-"+bz).click(function(bG){bG.preventDefault();bG.stopImmediatePropagation();var bF=a(this).attr("rel");a6.beforeclosewin(bF);bC.slideUp("fast",function(){bh();a6.afterclosewin(bv,bF)})})}}};this.zoomMap=function(bt){b(bt)};function aO(){a("#pp3diso-clicks").remove().empty();a("#pp3diso-Map").remove().empty();if(a6.mapZonesColors!=""){var bt=a6.mapZonesColors.split(":");var bu=bt.length;for(i=0;i<bu;i++){ar[i].clearRect(0,0,bp[i].width,bp[i].height)}a("pp3Diso-mapZone").remove().empty()}}function b(bu){a("#pp3diso-avatar").clearQueue();A=null;A=[];aU=null;aU=[];a(".pp3Diso_PF").remove().empty();if(bu<a6.zoom_min){bu=a6.zoom_min}if(bu>a6.zoom_max){bu=a6.zoom_max}aO();var bx=a6.zoom;a6.zoom=bu;var bC=bx-bu;var bF=e-((e*bC)|0);var bK=c-((c*bC)|0);e=bF;c=bK;v=~~(a6.zoom*100)+"%";a6.tx=R*a6.zoom;a6.ty2=(a6.tx>>1);a6.ty=Q*a6.zoom;a6.ty2=av*a6.zoom;aK=(a6.tx>>1);al=a6.ty2;aM=~~(K*(a6.tx));aL=~~(J*(al<<1)+(a6.ty2));C=(aM>>1);am=((ae-aM)>>1);W=((ad-aL)>>1);if(a6.mapZonesColors!=""){var bA=a6.mapZonesColors.split(":");var bw=bA.length;for(bI=0;bI<bw;bI++){bp[bI].width=aM;bp[bI].height=aL}}if(a6.auto_size){j.css({width:aM,height:aL})}aR(E);if(!a6.mode2d){aa.css("display","block")}aW(E);var bJ=[];bJ=bj;bj=null;bj=[];for(var bI in bJ){if(bJ[bI]["id"]!=""){var bD="o_"+bJ[bI]["id"];a("#"+bD).remove().empty();X(bJ[bI]["x"],bJ[bI]["y"],bJ[bI]["sprite"],bJ[bI]["decx"],bJ[bI]["decy"],bJ[bI]["titre"],bJ[bI]["bulle"],bJ[bI]["id"])}}for(var bz=1;bz<=J;bz++){for(var bB=1;bB<=K;bB++){if(ac[bz][bB]==2){var bD="b_"+bz+"_"+bB;bJ=(a("#"+bD).attr("rel")).split(":");a("#"+bD).remove().empty();aY(bB,bz,bJ[0],bJ[1],bJ[2])}}}var bt=a("#pp3diso-cursor-img");if(!bt.length==0){var bJ=bt.attr("rel").split(":");O=~~(bJ[0]*a6.zoom);N=~~(bJ[1]*a6.zoom);bt.attr("width",O).attr("height",N)}var bH=a("#pp3diso-avatar-img");if(!(bH.length==0)){if(Z){nbr_x=4}else{nbr_x=1}var bv=~~(100*aE)+"%";var bG=~~((a2*aE*a6.zoom)/aE);var bE=~~((a1*a6.zoom));var by=a("#pp3diso-avatar-img");a("#pp3diso-avatar").css({width:bG,height:bE});by.css({position:"absolute",overflow:"hidden",display:"block",left:0,top:0,width:bG*aE,height:bE*nbr_x})}aF=q*a6.zoom;aC=bg*a6.zoom;var bJ=a6.speed_avatar;a6.speed_avatar=1;B(bq,bo);a6.speed_avatar=bJ;P();a6.onchangezoom(bu)}this.moveMapOn=function(){var bv=["s","n","e","o","se","so","ne","no"];var bu=bv.length;for(var bt=0;bt<bu;bt++){var bw="#pp3diso-fleche-"+bv[bt];if(a(bw).length){a(bw).bind("mouseover",function(){var bx=a(this).attr("id");bx=bx.substr(15);if(!ao){ao=true;k(bx,a6.speed_by_titleset)}});a(bw).bind("mouseout",function(){o()})}}};function k(bv,bw){if(bm){return}var bt=(a6.ty>>1)*bw;var bu=(a6.tx>>1)*bw;switch(bv){case"n":c+=bt;break;case"ne":c-=bt;e-=bu;break;case"e":e-=bu;break;case"se":e-=bu;c+=bt;break;case"s":c-=bt;break;case"so":c+=bt;e+=bu;break;case"o":e+=bu;break;case"no":c-=bt;e+=bu;break}if(e<-(aM-ae)){e=-(aM-ae)}if(e>0){e=0}if(c<-(aL-ad)){c=-(aL-ad)}if(c>0){c=0}P();if(ao){clearInterval(ah);ah=setInterval(function(){if(ao&&!bm){k(bv,bw)}},a6.speed_map_while)}}this.moveMapOne=function(bt,bu){k(bt,bu)};this.moveMapWhile=function(bt,bu){ao=true;k(bt,bu)};function o(){ao=false;clearInterval(ah)}this.moveMapStop=function(){o()};this.tipShow=function(bw,bu,bt,bv){aT.css({display:"none"});aT.html(bw);if(bu==0){bt=h(S,U)+bc+bt;bv=g(S,U)+bb+bv}else{if(bu==1){if(bt<0){bt+=ae;bt-=aT.outerWidth()}if(bv<0){bv+=ad;bv-=aT.outerHeight()}bt-=e;bv-=c}}aT.css({top:bv,left:bt,display:"none"});aT.stop(true,true).fadeIn("normal");bi=true};this.tipHide=function(){aT.stop(true,true).fadeOut("normal",function(){bi=false})};this.toggleZone=function(bu,bv){if(bv==""){bv="normal"}bu--;var bt=a("#pp3Diso-mapZone-canvas-"+bu);if(bt.css("display")=="none"){bt.fadeIn(bv)}else{bt.fadeOut(bv)}};this.showZone=function(bt,bu){if(bu==""){bu="normal"}bt--;a("#pp3Diso-mapZone-canvas-"+bt).fadeIn(bu)};this.hideZone=function(bt,bu){if(bu==""){bu="normal"}bt--;a("#pp3Diso-mapZone-canvas-"+bt).fadeOut(bu)};this.switchCursorDelay=function(bt){au=bt};return this}})(jQuery);var mapLength,mapRowLength,gMinx,gMaxx,gMiny,gMaxy;function astar(j,f,k,g,b,d,r,o,q,m){var h=[];var l=[];var a=[];if(o==false){gMaxx=b.length}else{gMaxx=o}if(r==false){gMinx=0}else{gMinx=r}if(m==false){gMaxy=b[0].length}else{gMaxy=m}if(q==false){gMiny=0}else{gMiny=q}mapLength=gMaxx;mapRowLength=gMaxy;var e=new Node(k,g,b,null,null);var p=new Node(j,f,b,null,e);addNodeToList(p,h);var c;while(!isListEmpty(h)){c=returnNodeWithLowestFScore(h);addNodeToList(c,l);removeNodeFromList(c,h);if(areNodesEqual(c,e)){pathTo(c,a);a.reverse();return a}c.makeChildNodes(b,d,e);cullUnwantedNodes(c.childNodes,h);cullUnwantedNodes(c.childNodes,l);removeMatchingNodes(c.childNodes,h);removeMatchingNodes(c.childNodes,l);addListToList(c.childNodes,h)}return null}function pathTo(b,a){a.push(new NodeCoordinate(b.row,b.col));if(b.parentNode==null){return}pathTo(b.parentNode,a)}function addListToList(b,a){for(x in b){a.push(b[x])}}function removeMatchingNodes(d,f){var c=d.length;var e=f.length;for(var b=0;b<c;b++){for(var a=0;a<e;a++){if(f[a].row==d[b].row&&f[a].col==d[b].col){f.splice(a,1);e=f.length}}}}function cullUnwantedNodes(d,a){var e=a.length;var f=d.length;for(var c=0;c<e;c++){for(var b=0;b<f;b++){if(d[b].row==a[c].row&&d[b].col==a[c].col){if(d[b].f>=a[c].f){d.splice(b,1);f=d.length}}}}}function areNodesEqual(b,a){if(b.row==a.row&&b.col==a.col){return true}else{return false}}function returnNodeWithLowestFScore(b){var a=b[0];for(x in b){if(b[x].f<a.f){a=b[x]}}return a}function isListEmpty(a){return(a.length<1)?true:false}function removeNodeFromList(b,c){var d=c.length;for(var a=0;a<d;a++){if(b.row==c[a].row&&b.col==c[a].col){c.splice(a,1);break}}}function addNodeToList(a,b){b.push(a)}function returnHScore(b,d){var c=b.row-d.row;if(c<0){c=-c}var a=b.col-d.col;if(a<0){a=-a}if(a>c){return(c*14)+10*(a-c)}else{return(a*14)+10*(c-a)}}function NodeCoordinate(b,a){this.row=b;this.col=a}function Node(d,b,c,a,e){this.row=d;this.col=b;if(d<=gMiny){this.northAmbit=gMiny}else{this.northAmbit=d-1}if(d>=gMaxy-1){this.southAmbit=gMaxy-1}else{this.southAmbit=d+1}if(b<=gMinx){this.westAmbit=gMinx}else{this.westAmbit=b-1}if(b>=gMaxx-1){this.eastAmbit=gMaxx-1}else{this.eastAmbit=b+1}this.parentNode=a;this.childNodes=[];if(a!=null){if(d==a.row||b==a.col){this.g=a.g+10}else{this.g=a.g+14}this.h=returnHScore(this,e)}else{this.g=0;if(c[d][b]=="s"){this.h=returnHScore(this,e)}else{this.h=0}}this.f=this.g+this.h;this.makeChildNodes=function(k,f,l){for(var h=this.northAmbit;h<=this.southAmbit;h++){for(var g=this.westAmbit;g<=this.eastAmbit;g++){if(h!=this.row||g!=this.col){if(k[h][g]!="0"){if(f){this.childNodes.push(new Node(h,g,k,this,l))}else{if(h==this.row||g==this.col){this.childNodes.push(new Node(h,g,k,this,l))}}}}}}}}if(!document.createElement("canvas").getContext){(function(){var v=Math;var w=v.round;var s=v.sin;var G=v.cos;var n=v.abs;var F=v.sqrt;var a=10;var o=a/2;function h(){return this.context_||(this.context_=new q(this))}var u=Array.prototype.slice;function H(m,I,J){var j=u.call(arguments,2);return function(){return m.apply(I,j.concat(u.call(arguments)))}}var k={init:function(j){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var m=j||document;m.createElement("canvas");m.attachEvent("onreadystatechange",H(this.init_,this,m))}},init_:function(J){if(!J.namespaces.g_vml_){J.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML")}if(!J.namespaces.g_o_){J.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")}if(!J.styleSheets.ex_canvas_){var I=J.createStyleSheet();I.owningElement.id="ex_canvas_";I.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}var m=J.getElementsByTagName("canvas");for(var j=0;j<m.length;j++){this.initElement(m[j])}},initElement:function(m){if(!m.getContext){m.getContext=h;m.innerHTML="";m.attachEvent("onpropertychange",E);m.attachEvent("onresize",b);var j=m.attributes;if(j.width&&j.width.specified){m.style.width=j.width.nodeValue+"px"}else{m.width=m.clientWidth}if(j.height&&j.height.specified){m.style.height=j.height.nodeValue+"px"}else{m.height=m.clientHeight}}return m}};function E(m){var j=m.srcElement;switch(m.propertyName){case"width":j.style.width=j.attributes.width.nodeValue+"px";j.getContext().clearRect();break;case"height":j.style.height=j.attributes.height.nodeValue+"px";j.getContext().clearRect();break}}function b(m){var j=m.srcElement;if(j.firstChild){j.firstChild.style.width=j.clientWidth+"px";j.firstChild.style.height=j.clientHeight+"px"}}k.init();var e=[];for(var B=0;B<16;B++){for(var A=0;A<16;A++){e[B*16+A]=B.toString(16)+A.toString(16)}}function r(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(J,I){var m=r();for(var j=0;j<3;j++){for(var M=0;M<3;M++){var K=0;for(var L=0;L<3;L++){K+=J[j][L]*I[L][M]}m[j][M]=K}}return m}function z(m,j){j.fillStyle=m.fillStyle;j.lineCap=m.lineCap;j.lineJoin=m.lineJoin;j.lineWidth=m.lineWidth;j.miterLimit=m.miterLimit;j.shadowBlur=m.shadowBlur;j.shadowColor=m.shadowColor;j.shadowOffsetX=m.shadowOffsetX;j.shadowOffsetY=m.shadowOffsetY;j.strokeStyle=m.strokeStyle;j.globalAlpha=m.globalAlpha;j.arcScaleX_=m.arcScaleX_;j.arcScaleY_=m.arcScaleY_;j.lineScale_=m.lineScale_}function c(m){var K,J=1;m=String(m);if(m.substring(0,3)=="rgb"){var M=m.indexOf("(",3);var j=m.indexOf(")",M+1);var L=m.substring(M+1,j).split(",");K="#";for(var I=0;I<3;I++){K+=e[Number(L[I])]}if(L.length==4&&m.substr(3,1)=="a"){J=L[3]}}else{K=m}return{color:K,alpha:J}}function t(j){switch(j){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function q(m){this.m_=r();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle="#000";this.fillStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=a*1;this.globalAlpha=1;this.canvas=m;var j=m.ownerDocument.createElement("div");j.style.width=m.clientWidth+"px";j.style.height=m.clientHeight+"px";j.style.overflow="hidden";j.style.position="absolute";m.appendChild(j);this.element_=j;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1}var l=q.prototype;l.clearRect=function(){this.element_.innerHTML=""};l.beginPath=function(){this.currentPath_=[]};l.moveTo=function(m,j){var I=this.getCoords_(m,j);this.currentPath_.push({type:"moveTo",x:I.x,y:I.y});this.currentX_=I.x;this.currentY_=I.y};l.lineTo=function(m,j){var I=this.getCoords_(m,j);this.currentPath_.push({type:"lineTo",x:I.x,y:I.y});this.currentX_=I.x;this.currentY_=I.y};l.bezierCurveTo=function(I,m,O,N,M,K){var j=this.getCoords_(M,K);var L=this.getCoords_(I,m);var J=this.getCoords_(O,N);p(this,L,J,j)};function p(j,J,I,m){j.currentPath_.push({type:"bezierCurveTo",cp1x:J.x,cp1y:J.y,cp2x:I.x,cp2y:I.y,x:m.x,y:m.y});j.currentX_=m.x;j.currentY_=m.y}l.quadraticCurveTo=function(M,I,m,j){var L=this.getCoords_(M,I);var K=this.getCoords_(m,j);var N={x:this.currentX_+2/3*(L.x-this.currentX_),y:this.currentY_+2/3*(L.y-this.currentY_)};var J={x:N.x+(K.x-this.currentX_)/3,y:N.y+(K.y-this.currentY_)/3};p(this,N,J,K)};l.arc=function(P,N,O,K,m,I){O*=a;var T=I?"at":"wa";var Q=P+G(K)*O-o;var S=N+s(K)*O-o;var j=P+G(m)*O-o;var R=N+s(m)*O-o;if(Q==j&&!I){Q+=0.125}var J=this.getCoords_(P,N);var M=this.getCoords_(Q,S);var L=this.getCoords_(j,R);this.currentPath_.push({type:T,x:J.x,y:J.y,radius:O,xStart:M.x,yStart:M.y,xEnd:L.x,yEnd:L.y})};l.rect=function(I,m,j,J){this.moveTo(I,m);this.lineTo(I+j,m);this.lineTo(I+j,m+J);this.lineTo(I,m+J);this.closePath()};l.strokeRect=function(I,m,j,J){var K=this.currentPath_;this.beginPath();this.moveTo(I,m);this.lineTo(I+j,m);this.lineTo(I+j,m+J);this.lineTo(I,m+J);this.closePath();this.stroke();this.currentPath_=K};l.fillRect=function(I,m,j,J){var K=this.currentPath_;this.beginPath();this.moveTo(I,m);this.lineTo(I+j,m);this.lineTo(I+j,m+J);this.lineTo(I,m+J);this.closePath();this.fill();this.currentPath_=K};l.createLinearGradient=function(m,J,j,I){var K=new C("gradient");K.x0_=m;K.y0_=J;K.x1_=j;K.y1_=I;return K};l.createRadialGradient=function(J,L,I,m,K,j){var M=new C("gradientradial");M.x0_=J;M.y0_=L;M.r0_=I;M.x1_=m;M.y1_=K;M.r1_=j;return M};l.drawImage=function(V,I){var O,M,Q,ad,T,R,Y,af;var P=V.runtimeStyle.width;var U=V.runtimeStyle.height;V.runtimeStyle.width="auto";V.runtimeStyle.height="auto";var N=V.width;var ab=V.height;V.runtimeStyle.width=P;V.runtimeStyle.height=U;if(arguments.length==3){O=arguments[1];M=arguments[2];T=R=0;Y=Q=N;af=ad=ab}else{if(arguments.length==5){O=arguments[1];M=arguments[2];Q=arguments[3];ad=arguments[4];T=R=0;Y=N;af=ab}else{if(arguments.length==9){T=arguments[1];R=arguments[2];Y=arguments[3];af=arguments[4];O=arguments[5];M=arguments[6];Q=arguments[7];ad=arguments[8]}else{throw Error("Invalid number of arguments")}}}var ae=this.getCoords_(O,M);var J=Y/2;var m=af/2;var ac=[];var j=10;var L=10;ac.push(" <g_vml_:group",' coordsize="',a*j,",",a*L,'"',' coordorigin="0,0"',' style="width:',j,"px;height:",L,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var K=[];K.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",w(ae.x/a),",","Dy=",w(ae.y/a),"");var aa=ae;var Z=this.getCoords_(O+Q,M);var X=this.getCoords_(O,M+ad);var S=this.getCoords_(O+Q,M+ad);aa.x=v.max(aa.x,Z.x,X.x,S.x);aa.y=v.max(aa.y,Z.y,X.y,S.y);ac.push("padding:0 ",w(aa.x/a),"px ",w(aa.y/a),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",K.join(""),", sizingmethod='clip');")}else{ac.push("top:",w(ae.y/a),"px;left:",w(ae.x/a),"px;")}ac.push(' ">','<g_vml_:image src="',V.src,'"',' style="width:',a*Q,"px;"," height:",a*ad,'px;"',' cropleft="',T/N,'"',' croptop="',R/ab,'"',' cropright="',(N-T-Y)/N,'"',' cropbottom="',(ab-R-af)/ab,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",ac.join(""))};l.stroke=function(ah){var M=[];var N=false;var at=c(ah?this.fillStyle:this.strokeStyle);var ad=at.color;var an=at.alpha*this.globalAlpha;var J=10;var P=10;M.push("<g_vml_:shape",' filled="',!!ah,'"',' style="position:absolute;width:',J,"px;height:",P,'px;"',' coordorigin="0 0" coordsize="',a*J," ",a*P,'"',' stroked="',!ah,'"',' path="');var O=false;var ar={x:null,y:null};var Z={x:null,y:null};for(var am=0;am<this.currentPath_.length;am++){var al=this.currentPath_[am];var aq;switch(al.type){case"moveTo":aq=al;M.push(" m ",w(al.x),",",w(al.y));break;case"lineTo":M.push(" l ",w(al.x),",",w(al.y));break;case"close":M.push(" x ");al=null;break;case"bezierCurveTo":M.push(" c ",w(al.cp1x),",",w(al.cp1y),",",w(al.cp2x),",",w(al.cp2y),",",w(al.x),",",w(al.y));break;case"at":case"wa":M.push(" ",al.type," ",w(al.x-this.arcScaleX_*al.radius),",",w(al.y-this.arcScaleY_*al.radius)," ",w(al.x+this.arcScaleX_*al.radius),",",w(al.y+this.arcScaleY_*al.radius)," ",w(al.xStart),",",w(al.yStart)," ",w(al.xEnd),",",w(al.yEnd));break}if(al){if(ar.x==null||al.x<ar.x){ar.x=al.x}if(Z.x==null||al.x>Z.x){Z.x=al.x}if(ar.y==null||al.y<ar.y){ar.y=al.y}if(Z.y==null||al.y>Z.y){Z.y=al.y}}}M.push(' ">');if(!ah){var Y=this.lineScale_*this.lineWidth;if(Y<1){an*=Y}M.push("<g_vml_:stroke",' opacity="',an,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',t(this.lineCap),'"',' weight="',Y,'px"',' color="',ad,'" />')}else{if(typeof this.fillStyle=="object"){var Q=this.fillStyle;var V=0;var ak={x:0,y:0};var ae=0;var T=1;if(Q.type_=="gradient"){var S=Q.x0_/this.arcScaleX_;var m=Q.y0_/this.arcScaleY_;var R=Q.x1_/this.arcScaleX_;var au=Q.y1_/this.arcScaleY_;var ap=this.getCoords_(S,m);var ao=this.getCoords_(R,au);var L=ao.x-ap.x;var K=ao.y-ap.y;V=Math.atan2(L,K)*180/Math.PI;if(V<0){V+=360}if(V<0.000001){V=0}}else{var ap=this.getCoords_(Q.x0_,Q.y0_);var j=Z.x-ar.x;var I=Z.y-ar.y;ak={x:(ap.x-ar.x)/j,y:(ap.y-ar.y)/I};j/=this.arcScaleX_*a;I/=this.arcScaleY_*a;var aj=v.max(j,I);ae=2*Q.r0_/aj;T=2*Q.r1_/aj-ae}var ac=Q.colors_;ac.sort(function(av,W){return av.offset-W.offset});var X=ac.length;var ab=ac[0].color;var aa=ac[X-1].color;var ag=ac[0].alpha*this.globalAlpha;var af=ac[X-1].alpha*this.globalAlpha;var ai=[];for(var am=0;am<X;am++){var U=ac[am];ai.push(U.offset*T+ae+" "+U.color)}M.push('<g_vml_:fill type="',Q.type_,'"',' method="none" focus="100%"',' color="',ab,'"',' color2="',aa,'"',' colors="',ai.join(","),'"',' opacity="',af,'"',' g_o_:opacity2="',ag,'"',' angle="',V,'"',' focusposition="',ak.x,",",ak.y,'" />')}else{M.push('<g_vml_:fill color="',ad,'" opacity="',an,'" />')}}M.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",M.join(""))};l.fill=function(){this.stroke(true)};l.closePath=function(){this.currentPath_.push({type:"close"})};l.getCoords_=function(J,I){var j=this.m_;return{x:a*(J*j[0][0]+I*j[1][0]+j[2][0])-o,y:a*(J*j[0][1]+I*j[1][1]+j[2][1])-o}};l.save=function(){var j={};z(this,j);this.aStack_.push(j);this.mStack_.push(this.m_);this.m_=d(r(),this.m_)};l.restore=function(){z(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};function g(I){for(var K=0;K<3;K++){for(var J=0;J<2;J++){if(!isFinite(I[K][J])||isNaN(I[K][J])){return false}}}return true}function D(I,j,J){if(!g(j)){return}I.m_=j;if(J){var K=j[0][0]*j[1][1]-j[0][1]*j[1][0];I.lineScale_=F(n(K))}}l.translate=function(I,m){var j=[[1,0,0],[0,1,0],[I,m,1]];D(this,d(j,this.m_),false)};l.rotate=function(m){var J=G(m);var I=s(m);var j=[[J,I,0],[-I,J,0],[0,0,1]];D(this,d(j,this.m_),false)};l.scale=function(I,m){this.arcScaleX_*=I;this.arcScaleY_*=m;var j=[[I,0,0],[0,m,0],[0,0,1]];D(this,d(j,this.m_),true)};l.transform=function(K,J,M,L,m,j){var I=[[K,J,0],[M,L,0],[m,j,1]];D(this,d(I,this.m_),true)};l.setTransform=function(L,K,N,M,J,I){var j=[[L,K,0],[N,M,0],[J,I,1]];D(this,j,true)};l.clip=function(){};l.arcTo=function(){};l.createPattern=function(){return new f};function C(j){this.type_=j;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[]}C.prototype.addColorStop=function(m,j){j=c(j);this.colors_.push({offset:m,color:j.color,alpha:j.alpha})};function f(){}G_vmlCanvasManager=k;CanvasRenderingContext2D=q;CanvasGradient=C;CanvasPattern=f})()};